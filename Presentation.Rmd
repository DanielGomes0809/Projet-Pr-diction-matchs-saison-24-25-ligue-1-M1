---
title: "Pr√©dire les probabilit√©s des r√©sultats de match de football de Ligue 1"
author: HAVAN Marius - HAYOTTE Emil - GOMES-ALMEIDA Daniel
output: 
  powerpoint_presentation:
    reference_doc: Template_Ligue1.pptx
date: "2026-01-09"
---

```{r setup, include=FALSE}
setwd("C:/Users/Daniel/OneDrive/MPE/Analyse de donn√©e")
knitr::opts_chunk$set(echo = FALSE)
```

## Sommaire

-   Introduction

1)  Nettoyage des donn√©es
2)  Introduction g√©n√©rale

## Sommaire

-   Phase 1 : Entra√Ænement (apprentissage) sur les donn√©es des saisons 2021-2022, 2022-2023 et 2023-2024 r√©alis√© notamment gr√¢ce √† la cr√©ation de features.

1)  Cr√©ation des nouvelles variables
2)  Forme r√©cente des √©quipes
3)  Points cumul√©s par √©quipe
4)  Diff√©rentiels de buts

## Sommaire

-   Phase 2 : √âvaluation du mod√®le entra√Æn√© sur la saison 2024‚Äì2025

1)  Choix du mod√®le multinomiale
2)  √âvaluation des performances du mod√®le

-   Phase 3 : Pr√©diction des probabilit√©s sur la saison 2025-2026.

1)  G√©n√©ration des probabilit√©s de victoire
2)  Analyse et interpr√©tation

## Sommaire

-   Conclusion

1)Les limites et forces de notre code

## Introduction

-   Variables natives √† la base de donn√©es :

1)  *FTR* : R√©sultat d'un match
2)  *HomeTeam* : Nom de l'√©quipe √† domicile
3)  *AwayTeam* : Nom de l'√©quipe ext√©rieur
4)  *Date* : Date du match

Gr√¢ce √† cela nous allons pouvoir cr√©er trois variables d√©cisives pour la suite...

## Introduction

-   Premi√®res features :

1)  *home_points* : Point(s) gagn√©(s) par l'√©quipe √† domicile √† la fin du match
2)  *away_points* : Point(s) gagn√©(s) par l'√©quipe ext√©rieur √† la fin du match
3)  *match_id* : Identifiant chronologique du match

Ces variables seront d√©terminantes pour d√©finir les features principales.

## Introduction

-   Features principales :

1)  *form_diff_lastN* : Diff√©rence de forme r√©cente entre les deux √©quipes au match i.

2)  *cum_pts_diff* : Diff√©rence des points cumul√©s entre les deux √©quipes au match i.

3)  *cum_gd_diff* : Diff√©rence des buts cumul√©s (buts marqu√©s - buts encaiss√©s) entre les deux √©quipes au match i.

## Introduction

Apr√®s cela, nous nous attarderons sur la performance d'une mod√©lisation par apprentissage statistique, gr√¢ce √† l'entra√Ænement de nos features sur les trois saisons pr√©c√©dentes, en l'√©valuant sur la saison 2024-2025.

A l'aide d'un mod√®le multinomial on va d√©terminer la pr√©cision de ce dernier √† pr√©dire les probabilit√©s d'issues d'un match de football.

## Introduction

Enfin, on va essay√© de pr√©dire les r√©sultats de match, du moins leurs probabilit√©s, pour les matchs √† venir sur la saison actuelle 2025-2026 (matchs d'apr√®s tr√™ve).

On concluera ensuite quant aux r√©sultats de notre mod√®le tout en √©noncant ses diff√©rentes limites.

## Apprentissage du mod√®le : Forme r√©cente

On a cr√©√© gr√¢ce aux variables natives nos features *home_points*, *away_points* et *match_id*. Ainsi, on va pouvoir calculer la forme r√©cente de chaque √©quipe.

La forme r√©cente repr√©sente la moyenne des points de chaque √©quipe sur les N derniers matchs (dans notre cas : N = 5). Ainsi, on va prendre les 5 derniers matchs de notre √©quipe et calculer notre statistique d'avant match.

## Apprentissage du mod√®le : Forme r√©cente

```{r, eval=FALSE, echo=TRUE}
team_form <- team_matches %>%
  group_by(team) %>%
  mutate(
    form_pts_lastN = slide_dbl(
      .x = lag(points),
      .f = mean(.x, na.rm = TRUE),
      .before = N - 1,
      .complete = FALSE
    ))
```

## Apprentissage du mod√®le : Forme r√©cente

Apr√®s avoir attribu√© cette nouvelle fonction √† chaque √©quipe pour chaque match, on calcul la diff√©rence entre les deux √©quipes qui va nous donner la feature finale pour cette sous partie √† savoir *form_diff_lastN*.

Elle repr√©sente donc la diff√©rence de forme r√©cente entre les deux √©quipes au match i.

## Apprentissage du mod√®le : Points cumul√©s

On va donc proc√©der au calcul des points cumul√©s par √©quipe et par saison. L'objectif est de calculer pour chaque √©quipe le total de points cumul√©s avant chaque match et la diff√©rence de points cumul√©s puis faire une jointure dans la base de donn√©es.

## Apprentissage du mod√®le : Points cumul√©s

```{r, eval=FALSE, echo=TRUE}
team_cum_pts <- team_points %>%
  group_by(team, season) %>%                                                    
  mutate(
    cum_pts_before = lag(cumsum(points), 
                         default = 0)                           
                                                                               
   ) 
```

## Apprentissage du mod√®le : Points cumul√©s

Comme pour la forme r√©cente on applique *cum_pts_before* par √©quipe et par match ce qui nous permet d'obtenir les points cumul√©s de l'√©quipe √† domicile avant le match *home_cum_points*.

On a la m√™me chose pour l'√©quipe ext√©rieur avec *away_cum_points*.

Une nouvelle fois, on calcul la diff√©rence ce qui nous donne *cum_pts_diff*.

## Apprentissage du mod√®le : Diff√©rentiel de buts

L'objectif de cette sous-partie est de calculer pour chaque √©quipe et chaque saison le cumul de buts marqu√©s/encaiss√©s avant chaque match mais √©galement de rattacher ces cumuls au match et cr√©er des variables de comparaison entre les deux √©quipes qui s'affrontent pour un match donn√©.

## Apprentissage du mod√®le : Diff√©rentiel de buts

```{r, eval=FALSE, echo=TRUE}
mutate(
 cum_gf_including = cumsum(goals_for),                                       
 cum_ga_including = cumsum(goals_against),                                   
 cum_gf_before = lag(cum_gf_including,
                     default = 0),                         
 cum_ga_before = lag(cum_ga_including,
                     default = 0),                         
 cum_gd_before = cum_gf_before - cum_ga_before) 
```

## Apprentissage du mod√®le : Diff√©rentiel de buts

Encore une fois on applique *cum_gd_before* pour chaque match et √©quipe et ensuite on calcul la diff√©rence.

Ce qui nous donne *cum_gd_diff* qui repr√©sente la diff√©rence des buts cumul√©s entre les deux √©quipes avant de jouer le match par saison.

## Choix du mod√®le multinomiale

üéØ Objectif du Mod√®le Multinomial:

- Estimation des diff√©rentes issues possibles d'un match √† partir de variables explicatives 

Variable d√©pendante : R√©sultat final (*FTR* : Home, Draw, Away).

Variables explicatives :

üìà Forme r√©cente (*form_diff_lastN*)

üèÜ Points cumul√©s (*cum_pts_diff*)

‚öΩ Diff√©rentiel de buts (*cum_gd_diff*) 

## Choix du mod√®le multinomiale

Le choix de la r√©gression multinomiale repose sur deux piliers :

1. Nature de la variable √† expliquer : Variable qualitative √† 3 modalit√©s.
      - Absence d'ordre naturel entre Victoire, Nul et D√©faite

2. Interpr√©tabilit√© : Mod√®le permettant de comprendre facilement comment chaque variable influence les probabilit√©s

## √âvaluation des performances du mod√®le

‚öôÔ∏è Entrainement du mod√®le :

```{r, eval=FALSE, echo=TRUE}
model_multinom <- multinom(
  FTR ~ form_diff_lastN + cum_pts_diff + cum_gd_diff,
  data = train_data, trace = FALSE)
```

Application du mod√®le √† la saison 24/25 en se basant uniquement sur les saisons 21/22 √† 23/24 (*train_data*)

## √âvaluation des performances du mod√®le

R√©sultats:

- Bonne pr√©diction des victoires √† domicile, mais difficult√© pour les vitoires √† l'ext√©rieur

- Matchs nuls rarement pr√©dits : forte incertitude, car d√©pendance d'√©venements difficiles √† anticiper

- Accuracy de 54% : mod√®le capte une partie des dynamiques de performance des √©quipes, mais montre aussi caract√®re al√©atoire du football


## Phase 3 : Pr√©diction des probabilit√©s sur la saison 2025‚Äì2026

1) G√©n√©ration des probabilit√©s de victoire pour les matchs d√©j√† jou√©s de la saison 25/26

2) G√©n√©ration des probabilit√©s de victoire pour les matchs futurs de la saison 25/26 


## 1) G√©n√©ration des probabilit√©s de victoire pour les matchs d√©j√† jou√©s de la saison 25/26


::: {.columns}

::: {.column width="60%"}
### Objectif
Utiliser le mod√®le multinomial entra√Æn√© sur les saisons 2021‚Äì2022 √† 2023‚Äì2024 et √©valuer sur la saison 2024‚Äì2025, afin de pr√©dire les probabilit√©s pour tous les matches de la saison 2025‚Äì2026.
:::

::: {.column width="40%"}
### Pr√©diction
- Victoire √† domicile (H)
- Match nul (D)
- Victoire √† l‚Äôext√©rieur (A)
:::

:::

## Point de Vigilance 

Faire attention qu'aucune information issue des r√©sultats de la saison 2025‚Äì2026 n‚Äôest utilis√©e dans l‚Äôapprentissage du mod√®le, garantissant l‚Äôabsence totale de fuite temporelle ou de bias. 

## ` `

::: {.columns}

::: {.column width="50%"}
### (i) Construction de l'√©chantillon
**Saison 2025‚Äì2026**

* **Nettoyage** : Exclusion des premiers matches de la saison.
* **Raison** : Historique insuffisant pour calculer les variables de "forme r√©cente".
:::

::: {.column width="50%"}
### (ii) Application du mod√®le
**Pr√©diction des probabilit√©s**

* Utilisation du mod√®le **multinomial** pr√©-entra√Æn√©.
* Application directe sur les nouvelles observations de la saison actuelle.
:::

:::

---

## ` `

### (iii) Int√©gration des probabilit√©s

L'objectif est d'enrichir la base `pred_2526_out` avec les scores de probabilit√©s et d'identifier le r√©sultat le plus probable (**Argmax**)

## (iv) Illustration : matches tr√®s d√©s√©quilibr√©s vs matches tr√®s incertains
**Les Matches les plus d√©s√©quilibr√©s :**
Opposition d'une √©quipe en forte dynamique faec √† une √©quipe en difficult√©
```{r}
top10_pred_des <- readRDS("top10_pred_des.rds")
```

```{r, echo=FALSE}
knitr::kable(top10_pred_des)
```

## ` `
**Les matches les plus incertains :**
Opposition d'√©quipes proches en termes de performance, des d√©buts de saison ou des confrontations historiquement √©quilibr√©es
```{r}
top10_pred_inc <- readRDS("top10_pred_inc.rds")
```

```{r, echo=FALSE}
knitr::kable(top10_pred_inc)
```

## 2) G√©n√©ration des probabilit√©s de victoire pour les matchs futurs de la saison 25/26 
**(i) Ajout des rencontres non disponibles (Base 25/26)**

- La base de donn√©e de la saison 25/26 contient uniquement les matchs qui ont d√©j√† √©t√© jou√©s.
- Il faut ajouter les matchs restants de la saison 25/26

## ` `
**Exemple: Ajout de la journ√©e 33**

```{r, eval=FALSE, echo=TRUE}
fixtures_33 <- tribble(
  ~Round, ~Date,        ~HomeTeam,     ~AwayTeam,
  33, "2026-05-09", "Angers",      "Strasbourg",
  33, "2026-05-09", "Auxerre",     "Nice",
  "etc")
```
Nous allons ensuite pouvoir fixer toutes ces journ√©es supl√©mentaires √† la base de donn√©e
via *bind_rows*

## (ii) Matchs futurs (post tr√™ve)

- Identification des matchs futurs jou√©s apr√®s la tr√™ve hivernale 
- Filtre les rencontres sans r√©sultat connu (*FTR* manquant)
- Conserve uniquement les informations essentielles (date et √©quipes)

## (iii) Historique des matchs jou√©s et transformation en √©quipe-match

- Extrait de l‚Äôhistorique des matchs d√©j√† jou√©s 
- Transformation en une table √©quipe‚Äìmatch 
- Pour chaque rencontre, on calcule les points obtenus et la diff√©rence de buts
- On obtient la table finale *team_games* qui constitue la base n√©cessaire au calcul des cumuls 
  et de la forme r√©cente des √©quipes

## (iv) Features par √©quipe avant chaque match

- Obtient la table finale *team_state* qui synth√©tise l‚Äô√©tat de forme 
  et de performance de chaque √©quipe √† chaque date
  
## (v) Rolling join

- Utilisation d'un rolling join temporel *foverlaps* pour r√©cup√©rer, 
  par √©quipe et par saison, les features calcul√©es 
  lors du dernier match jou√© pr√©c√©dant chaque fixture
  
## (vi) Construction table finale des features *future_feat* et diff√©rentiels des features

- Construction de la table finale des features pour les matchs futurs 
- On calcule ensuite les diff√©rentiels domicile ‚Äì ext√©rieur pour les trois variables retenues:
Forme r√©cente, points cumul√©s, diff√©rence de buts cumul√©e 
- On conserve uniquement les matchs pour lesquels toutes les features sont disponibles

## Pr√©dictions et Table Finale

::: {.columns}

::: {.column width="50%"}
### (vii) Pr√©diction H/D/A
- Application du mod√®le multinomial entra√Æn√© pour pr√©dire les r√©sultats H/D/A 
  des matchs futurs pour lesquels les features sont disponibles
:::

::: {.column width="50%"}
### (viii) Table finale
- Construction de la table finale des pr√©dictions pour les matchs futurs
:::

:::

## V) Aper√ßu de l'Interface de Pr√©diction


![](Image Interface.png){width="90%"}

## Conclusion : ‚ö†Ô∏è Limites

- Utilisation uniquement de donn√©es de match agr√©g√©es et pas de variables contextuelles comme les blessures ou les suspensions

- **Difficult√© √† pr√©dire les matchs nuls** : statistiquement moins fr√©quents et beaucoup plus h√©t√©org√®nes

- R√©gression multinomiale ne capture pas les interactions complexes entre les variables explicatives => mod√®les plus flexibles comme les r√©seaux de neurones

## Conclusion : üí™ Forces

- **Absence de fuite temporelle** : utilisation que d'informations disponibles au moment de la pr√©diction

- Variables explicatives r√©sument efficacement l'information disponible avant le match qui permet au mod√®le d'int√©grer √† la fois l'√©tat de forme actuel et la qualit√© moyenne de l'√©quipe sur la saison

- **Mod√©lisation dynamique de la saison** : probabilit√©s pr√©dites √©voluent au fil des journ√©es